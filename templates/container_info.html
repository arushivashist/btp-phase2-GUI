{% extends "base.html" %}
{% block content %}
<h1 class="text-center">Docker Monitoring Tool</h1>
  <div class="row">
    <div class="col-lg-4 col-lg-offset-4">
      <h3>Name: {{ cont['Names'][0] }}</h3>
      <h3>Image: {{ cont['Image'] }}</h3>
      <h3>Created: {{ cont['Created'] }}</h3>
      <h3>Id: {{ cont['Id'][:8] }}</h3>
      <a href="{{ url_for('container_pty') + "?cont_id=" + cont['Id'] }}"><h3>Open PTY</h3></a>
    </div>
  </div>
  <div class="ct-chart"></div>
  <script type="text/javascript" charset="utf-8">
    function getQueryVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for(var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
        if(pair[0] == variable) {
            return pair[1];
        }
      } 
    }
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    socket.on('connect', function() {
      setInterval(function() {
        socket.emit('req_api_container_info', {cont_id: getQueryVariable('cont_id')});
      }, 1000);
    });

    var chart = new Chartist.Line('.ct-chart', {
      labels: ['1s', '2s', '3s', '4s', '5s', '6s', '7s', '8s', '9s', '10s'],
      series: [[]]
    }, {
      fullWidth: true,
      height: 500,
      high: 100,
      low: 0
    });

    socket.on('resp_api_container_info', function(data) {
      console.log(chart.data.series[0].length);
      cpu_delta = parseFloat(data['cpu_new']['cpu_usage']['total_usage']) - parseFloat(data['cpu_old']['cpu_usage']['total_usage']);
      system_delta = parseFloat(data['cpu_new']['system_cpu_usage']) - parseFloat(data['cpu_old']['system_cpu_usage']);
      if(system_delta > 0.0) {
        total = (cpu_delta / system_delta) * 100;
        if(chart.data.series[0].length < chart.data.labels.length) {
          chart.data.series[0].push(total);
        }
        else {
          for(var i=1; i<chart.data.series[0].length; i++) {
            chart.data.series[0][i-1] = chart.data.series[0][i];
          }
          chart.data.series[0][chart.data.series[0].length-1] = total;
        }
	console.log(total);
        chart.update();
      }
    });
</script>
{% endblock %}
